<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>All Suggestions - Admin</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
  />
  <style>
  body {
    background-color: #283e96c4;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  /* Header Banner for Admin */
  .admin-header {
    background: linear-gradient(to right, #004080, #0066cc);
    color: white;
    padding: 25px 30px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
  }

  .admin-header h2 {
    margin: 0;
    font-size: 1.9rem;
    font-weight: 600;
  }

  .card {
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    border: none;
  }

  .suggestion-card {
  opacity: 1;
  transition: opacity 0.3s ease;
}


  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 24px rgba(0, 0, 0, 0.1);
    background-color: #ffffff;
  }

  .dropdown-menu {
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .dropdown-item:hover {
    background-color: #f0f2f5;
    color: #0d6efd;
    font-weight: 500;
  }
  
  .vote-count {
  color: #0056b3; /* brighter blue */
  font-weight: 600;
}


  .suggestion-card {
    transition: all 0.4s ease-in-out;
  }

  .suggestion-card .comment-box {
    max-height: 300px;
    overflow-y: auto;
    transition: opacity 0.3s ease-in-out;
    background-color: #f8f9fa;
    padding: 10px;
    border-radius: 10px;
  }

  .btn-primary {
    transition: box-shadow 0.3s ease;
  }

  .btn-primary:hover,
  .btn-primary:focus {
    background-color: #0d6efd;
    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.4);
    color: #fff;
  }

  /* Improved select dropdown */
  select.form-select {
    border-radius: 8px;
    padding: 6px 10px;
    border: 1px solid #ced4da;
    background-color: #f8f9fa;
    transition: border-color 0.3s ease;
    font-size: 0.9rem;
    margin-top: 10px;
  }

  select.form-select:focus {
    outline: none;
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.25);
  }

  .form-select {
  border-radius: 8px;
  padding: 0.45rem 1.2rem;
  border: 1px solid #ced4da;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  transition: all 0.2s ease-in-out;
}

.form-select:hover,
.form-select:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.2);
}

  .form-select option {
    padding: 6px;
  }

  /* Comment box improvements */
  .comments p {
    background-color: #fff;
    border-left: 4px solid #0d6efd;
    padding: 10px 15px;
    margin-bottom: 10px;
    border-radius: 8px;
    font-size: 0.9rem;
  }

  .comments small {
    font-size: 0.75rem;
    color: #6c757d;
  }

  textarea.form-control {
    border-radius: 8px;
    resize: none;
  }

  /* Make the status dropdown more compact */
select.form-select.form-select-sm.mt-2 {
  padding: 0.25rem 0.5rem;
  font-size: 0.85rem;
  width: auto;
  max-width: 160px;
  display: inline-block;
  margin-top: 0.5rem;
}

</style>

</head>

<body>
  <div class="container mt-5">
<div class="admin-header d-flex justify-content-between align-items-center">
  <h2>Admin Suggestions Dashboard</h2>

  <div class="d-flex">
    <!-- Search bar -->
    <div class="input-group me-2" style="max-width: 250px;">
      <input type="text" id="searchInput" onkeyup="filterSuggestions()" class="form-control" placeholder="Search suggestions..." />
      <span class="input-group-text"><i class="fas fa-search"></i></span>
    </div>

    <!-- Filter Button -->
    <div class="dropdown me-2">
      <button
        class="btn btn-light dropdown-toggle"
        type="button"
        id="facultyDropdownBtn"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        Filter by Faculty: <span id="selectedFaculty">All Faculties</span>
      </button>
      <ul class="dropdown-menu" aria-labelledby="facultyDropdownBtn" id="facultyDropdownMenu">
        <li><a class="dropdown-item active" href="#" data-faculty="All">All Faculties</a></li>
        <li><a class="dropdown-item" href="#" data-faculty="FCI">FCI</a></li>
        <li><a class="dropdown-item" href="#" data-faculty="FOE">FOE</a></li>
        <li><a class="dropdown-item" href="#" data-faculty="FOM">FOM</a></li>
        <li><a class="dropdown-item" href="#" data-faculty="FCM">FCM</a></li>
      </ul>
    </div>

    <!-- Sort Button -->
    <div class="dropdown">
      <button
        class="btn btn-light dropdown-toggle"
        type="button"
        id="SortDropdown"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        <i class="fas fa-filter me-1"></i> Sort
      </button>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="SortDropdown" id="sortDropdownMenu">
        <li><a href="#" class="dropdown-item" id="sortUpvoted"><i class="fas fa-arrow-up-wide-short me-2"></i> Upvoted</a></li>
        <li><a href="#" class="dropdown-item" id="sortStatus"><i class="fas fa-list-check me-2"></i> Status</a></li>
      </ul>

    </div>
  </div>
</div>

<!-- Status Filter Dropdown - initially hidden -->
<div id="statusFilterDropdown" class="dropdown-menu p-2" 
     style="min-width: 180px; max-width: 220px; opacity: 0; transform: translateY(-10px); pointer-events: none; transition: opacity 0.3s ease, transform 0.3s ease; margin-top: 5px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: absolute; z-index: 1051;">
  <h6 class="dropdown-header">Filter by Status</h6>
  <button class="dropdown-item status-filter-item active" data-status="All">All</button>
  <button class="dropdown-item status-filter-item" data-status="Pending ‚è≥">Pending ‚è≥</button>
  <button class="dropdown-item status-filter-item" data-status="In Progress üîß">In Progress üîß</button>
  <button class="dropdown-item status-filter-item" data-status="Accepted ‚úÖ">Accepted ‚úÖ</button>
  <button class="dropdown-item status-filter-item" data-status="Rejected ‚ùå">Rejected ‚ùå</button>
</div>





    <div id="posts">
      {% for post in posts %}
      <div class="card mb-3 suggestion-card"
     data-id="{{ post.id }}"
     data-votes="{{ post.votes }}"
     data-search="{{ post.suggestion }} {{ post.faculty }} {{ post.reason }}">
        <div class="card-body">
          <h5 class="card-title">{{ post.suggestion }}</h5>
          <h6 class="card-subtitle mb-2 text-muted">{{ post.faculty }}</h6>
          <p>{{ post.reason }}</p>
          <span class="vote-count" id="votes-{{ post.id }}">{{ post.votes }} votes</span>
          <span class="badge bg-secondary ms-2">{{ post.status or 'Pending ‚è≥' }}</span>

          <!-- Admin can update status -->
          <select class="form-select form-select-sm mt-2" onchange="updateStatus({{ post.id }}, this.value)">
            <option value="Pending ‚è≥" {% if post.status == 'Pending ‚è≥' %}selected{% endif %}>Pending ‚è≥</option>
            <option value="In Progress üîß" {% if post.status == 'In Progress üîß' %}selected{% endif %}>In Progress üîß</option>
            <option value="Accepted ‚úÖ" {% if post.status == 'Accepted ‚úÖ' %}selected{% endif %}>Accepted ‚úÖ</option>
            <option value="Rejected ‚ùå" {% if post.status == 'Rejected ‚ùå' %}selected{% endif %}>Rejected ‚ùå</option>
          </select>

          <button class="btn btn-link mt-2" onclick="toggleCard(this)">Add Comments</button>

          <div class="comment-box mt-3 d-none">
            <div class="comments mb-3" id="comments-{{ post.id }}"></div>
            {% if current_user.role == 'admin' %}
            <form method="POST" action="/comment/{{ post.id }}">
              <textarea name="content" class="form-control mb-2" required></textarea>
              <button class="btn btn-sm btn-primary" type="submit">Add Comment</button>
            </form>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

 <!-- (Your <head> and style remains unchanged up to </style>) -->

<script>
  // Combined filter variables
  let selectedFaculty = "All";
  let selectedStatus = "All";

  // Toggle comment box visibility and fetch comments once
  function toggleCard(btn) {
    const cardBody = btn.closest('.card-body');
    const commentBox = cardBody.querySelector('.comment-box');
    commentBox.classList.toggle('d-none');
    if (!commentBox.classList.contains('loaded')) {
      const postId = cardBody.closest('.card').dataset.id;
      fetch(`/get_comments/${postId}`)
        .then(res => res.json())
        .then(data => {
          const commentsContainer = commentBox.querySelector('.comments');
          commentsContainer.innerHTML = data.map(c =>
            `<p><strong>${c.username}:</strong> ${c.content} <br><small class="text-muted">${c.timestamp}</small></p>`
          ).join('');
          commentBox.classList.add('loaded');
        });
    }
  }

  function updateStatus(postId, newStatus) {
    fetch(`/admin/update_status/${postId}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ status: newStatus })
    });
  }

  function sortByVotes() {
    const cards = Array.from(document.querySelectorAll('.suggestion-card'));
    cards.sort((a, b) => parseInt(b.dataset.votes) - parseInt(a.dataset.votes));
    const container = document.getElementById('posts');
    container.innerHTML = '';
    cards.forEach(card => container.appendChild(card));
  }

  function sortByStatus() {
    const cards = Array.from(document.querySelectorAll('.suggestion-card'));
    cards.sort((a, b) => {
      const statusA = a.querySelector('select').value;
      const statusB = b.querySelector('select').value;
      return statusA.localeCompare(statusB);
    });
    const container = document.getElementById('posts');
    container.innerHTML = '';
    cards.forEach(card => container.appendChild(card));
  }

  // Search logic
  function filterSuggestions() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const cards = document.querySelectorAll(".suggestion-card");

    cards.forEach(card => {
      const searchText = card.getAttribute("data-search").toLowerCase();
      const cardFaculty = card.querySelector(".card-subtitle").textContent.trim();
      const cardStatus = card.querySelector("select").value;

      const matchesSearch = searchText.includes(query);
      const matchesFaculty = selectedFaculty === "All" || cardFaculty === selectedFaculty;
      const matchesStatus = selectedStatus === "All" || cardStatus === selectedStatus;

      if (matchesSearch && matchesFaculty && matchesStatus) {
        card.style.display = "block";
      } else {
        card.style.display = "none";
      }
    });
  }

  // Faculty filter
  const facultyDropdownMenu = document.getElementById('facultyDropdownMenu');
  const selectedFacultySpan = document.getElementById('selectedFaculty');

  facultyDropdownMenu.addEventListener('click', (e) => {
    e.preventDefault();
    const target = e.target;
    if (target.classList.contains('dropdown-item')) {
      selectedFaculty = target.dataset.faculty;

      facultyDropdownMenu.querySelectorAll('.dropdown-item').forEach(item => {
        item.classList.remove('active');
      });
      target.classList.add('active');

      selectedFacultySpan.textContent = selectedFaculty === 'All' ? 'All Faculties' : selectedFaculty;
      filterSuggestions();
    }
  });

  // Show/hide and apply status filter
  const statusFilterDropdown = document.getElementById('statusFilterDropdown');
  const sortStatusBtn = document.getElementById('sortStatus');

  sortStatusBtn.addEventListener('click', (e) => {
    e.preventDefault();
    const rect = sortStatusBtn.getBoundingClientRect();
    statusFilterDropdown.style.left = `${rect.left}px`;
    statusFilterDropdown.style.top = `${rect.bottom + window.scrollY}px`;
    statusFilterDropdown.style.opacity = 1;
    statusFilterDropdown.style.transform = "translateY(0)";
    statusFilterDropdown.style.pointerEvents = "auto";
  });

  document.addEventListener("click", (e) => {
    if (!statusFilterDropdown.contains(e.target) && e.target.id !== "sortStatus") {
      statusFilterDropdown.style.opacity = 0;
      statusFilterDropdown.style.transform = "translateY(-10px)";
      statusFilterDropdown.style.pointerEvents = "none";
    }
  });

  document.querySelectorAll(".status-filter-item").forEach(item => {
    item.addEventListener("click", () => {
      document.querySelectorAll(".status-filter-item").forEach(i => i.classList.remove("active"));
      item.classList.add("active");

      selectedStatus = item.getAttribute("data-status");
      filterSuggestions();
    });
  });

  // Hook up sorting buttons
  document.getElementById('sortUpvoted').addEventListener('click', (e) => {
    e.preventDefault();
    sortByVotes();
  });

  document.getElementById('sortStatus').addEventListener('click', (e) => {
    e.preventDefault();
    sortByStatus();
  });

  // Attach search input event listener
  document.getElementById("searchInput").addEventListener("keyup", filterSuggestions);

</script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>






